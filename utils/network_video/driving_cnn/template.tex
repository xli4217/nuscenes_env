\documentclass[border=0cm,convert={outext=.png}]{standalone}
%\documentclass[border=0cm]{standalone}
% Documentclass to directly create a PNG-files when invoking 'pdflatex'

\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\renewcommand{\familydefault}{\sfdefault}
\colorlet{ngreen}{green!80!black}
\colorlet{nred}{red!80!black}
\colorlet{ngray}{white!80!black}

\usetikzlibrary{calc}

\usetikzlibrary{fadings}

\makeatletter
\pgfdeclareradialshading{tikz@lib@fade@circle@5}{\pgfpointorigin}{%
	color(0pt)=(pgftransparent!0); color(23.75bp)=(pgftransparent!0);%
	color(25bp)=(pgftransparent!100); color(50bp)=(pgftransparent!100)%
}
\pgfdeclareradialshading{tikz@lib@fade@circle@90}{\pgfpointorigin}{%
	color(0pt)=(pgftransparent!100); color(15bp)=(pgftransparent!100);%
	color(25bp)=(pgftransparent!50); color(50bp)=(pgftransparent!50)%
}
\pgfdeclarefading{circle with fuzzy edge 5 percent}{%
	\pgfuseshading{tikz@lib@fade@circle@15}%
}
\pgfdeclarefading{circle with fuzzy edge 90 percent}{%
	\pgfuseshading{tikz@lib@fade@circle@90}%
}
\makeatother
\begin{tikzfadingfrompicture}[name=custom fade]%
	\path(-0.2cm,0.2cm) rectangle (1.2cm,-2cm); % Arrow line is an overlay!
	\pgfinterruptboundingbox
	\draw[very thick,transparent!20,->] (0cm,0cm) .. controls +(0cm,-1cm) and +(0cm,1cm) .. (1cm,-2cm);
	\endpgfinterruptboundingbox
\end{tikzfadingfrompicture}

\usepackage{pgfplots}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{fadings}
\tikzfading[name=myfading, right color=transparent!50, left color=transparent!0]


\tikzset{
	autogreen/.style={fill=green!80!black},
	autored/.style={fill=red!80!black},
	sensoryline/.style={line width=0.8,draw=white!50!black,opacity=0.5},
	exsynsensory/.style={-{Triangle[length=0.09cm,width=0.09cm]},line width=0.8,draw=white!50!black,opacity=0.5},
	inhsynsensory/.style={-{Bar[width=0.13cm]},shorten >= 0.1cm,line width=0.8,draw=white!50!black,opacity=0.5},
	exsyn/.style={-{Triangle[length=0.09cm,width=0.09cm]},line width=0.8,looseness=1,draw=white!50!black,opacity=0.5},
	inhsyn/.style={-{Bar[width=0.13cm]},shorten >= 0.1cm,line width=0.8,draw=white!50!black,opacity=0.5,looseness=1},
}

% Load dynamic variables
\input{dynamic.tex}

\begin{document}
\begin{tikzpicture}[every node/.style={font={\sffamily}},neuron/.style={circle,inner sep=0.07cm,fill=black!40!white},neuronart/.style={rectangle,inner sep=0,minimum width=0.05cm,minimum height=0.05cm,fill=black!40!white},feature/.style={draw=none,minimum width=0.2cm,minimum height=0.1cm,inner sep=0}]


\draw[fill=black] (-2.5,-5.5) rectangle (10.7,2.0);
%\draw[fill=black] (-2.5,-5.5) rectangle (20.5,1.5);
% My Latex code
%\node at (2.5,-2) [opacity=0.25,white,align=center] {\Huge{Work-in }\\\\\\\Huge{progress}};
%\node at (8.5,-2) [opacity=0.25,white,align=center] {\Huge{Do not}\\\\\\\Huge{distribute}};
\node (cam) at (0,0) [inner sep=0,draw=white,line width=1mm] {\framecamera};

\node at (-2.0,1.7) [anchor=west,color=white] {\footnotesize{CNN driving performance}};
\node at (-2.0,1.4) [anchor=west,color=white] {\scriptsize{\titletext}};
\node at (0,1) [anchor=center,color=white] {\scriptsize{Camera input stream}};
\node at (0,-3) [anchor=center,color=white] {\scriptsize{Attention map}};

\draw[automodecolor] (-2,-5.30) circle (0.1cm);
\node at (-1.9,-5.30) [anchor=west,color=white] {\scriptsize{Mode:}};
\node at (-1,-5.30) [anchor=west,color=white] {\scriptsize{\automode}};

\node (conv1) at (0,-1.9) [rectangle,draw=olive,line width=1,inner sep=0] {\layera};
\node (conv12) at ($(conv1)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layera};
\node (conv13) at ($(conv12)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layera};

\shade[top color=white!10!black,bottom color=white!50!black] (cam.south east) -- (conv1.north east) -- (conv1.north west) -- (cam.south west) ;

\node (conv2) at (1.5,-1.9) [rectangle,draw=olive,line width=1,inner sep=0] {\layerc};
\node (conv22) at ($(conv2)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layerc};
\node (conv23) at ($(conv22)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerc};

\node (conv3) at (2.8,-1.8) [rectangle,draw=cyan,line width=1,inner sep=0] {\layerc};
\node (conv32) at ($(conv3)+(0.05,-0.05)$) [rectangle,draw=olive,line width=1,inner sep=0] {\layerc};
\node (conv33) at ($(conv32)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layerc};;
\node (conv34) at ($(conv33)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerc};

\node (conv4) at (4.5,-1.8) [rectangle,draw=cyan,line width=1,inner sep=0] {\layerd};
\node (conv42) at ($(conv4)+(0.05,-0.05)$) [rectangle,draw=olive,line width=1,inner sep=0] {\layerd};
\node (conv43) at ($(conv42)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layerd};;
\node (conv44) at ($(conv43)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerd};
\node (conv45) at ($(conv44)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerd};


%\begin{scope}[shift={(0,-0.1)}]
%\node (cfeat7) at (4.2,1) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimga};
%\node (cfeat6) at (4.2,0.2) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgb};
%\node (cfeat5) at (4.2,-0.6) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgc};
%\node (cfeat4) at (4.2,-1.4) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgd};
%\node (cfeat3) at (4.2,-2.2) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimge};
%\node (cfeat2) at (4.2,-3) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgf};
%\node (cfeat1) at (4.2,-3.8) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgg};
%\node (cfeat0) at (4.2,-4.6) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgh};
%\end{scope}




\node (sal) at (0,-4.0) [,draw=white,line width=1mm,inner sep=0] {\framesaliency};

\begin{scope}[shift={(6.5,0.25)}]
%\node (steer) at (3.5,-2.5) [outputcol,rectangle,draw,minimum width=0.4cm,minimum height=0.4cm] {};
\node (steer) at (3.6,-2.5) [circle,minimum width=0.4cm,minimum height=0.6cm,inner sep=0] {};
\node (nout) at (2.8,-2.5) [neuron,fill=outputcol] {};
\shade[top color=white!10!black,bottom color=white!50!black] (nout.south east) -- (steer.south west) -- (steer.north west) -- (nout.north east) ;

\fill[even odd rule,outputcol,outer color=black] (3.5,-2.5) circle (0.4);
\draw[thick,color=black] (3.5,-2.5) circle (0.4);
\node (steer) at (3.5,-2.5) [outputrot,circle,inner sep=0] {\includegraphics[width=0.7cm]{wheel.png}};
%\draw[thick,red] (3.5,-1.5) arc (0:50:1cm);

\end{scope}

%\begin{scope}[shift={(1,-5)}]
%\node (input0) at (4.5,0.00) [feature] {};
%\node (input1) at (4.5,0.20) [feature] {};
%\node (input2) at (4.5,0.40) [feature] {};
%\node (input3) at (4.5,0.60) [feature] {};
%\node (input4) at (4.5,0.80) [feature] {};
%\node (input5) at (4.5,1.00) [feature] {};
%\node (input6) at (4.5,1.20) [feature] {};
%\node (input7) at (4.5,1.40) [feature] {};
%\node (input8) at (4.5,1.60) [feature] {};
%\node (input9) at (4.5,1.80) [feature] {};
%\node (input10) at (4.5,2.00) [feature] {};
%\node (input11) at (4.5,2.20) [feature] {};
%\node (input12) at (4.5,2.40) [feature] {};
%\node (input13) at (4.5,2.60) [feature] {};
%\node (input14) at (4.5,2.80) [feature] {};
%\node (input15) at (4.5,3.00) [feature] {};
%\node (input16) at (4.5,3.20) [feature] {};
%\node (input17) at (4.5,3.40) [feature] {};
%\node (input18) at (4.5,3.60) [feature] {};
%\node (input19) at (4.5,3.80) [feature] {};
%\node (input20) at (4.5,4.00) [feature] {};
%\node (input21) at (4.5,4.20) [feature] {};
%\node (input22) at (4.5,4.40) [feature] {};
%\node (input23) at (4.5,4.60) [feature] {};
%\node (input24) at (4.5,4.80) [feature] {};
%\node (input25) at (4.5,5.00) [feature] {};
%\node (input26) at (4.5,5.20) [feature] {};
%\node (input27) at (4.5,5.40) [feature] {};
%\node (input28) at (4.5,5.60) [feature] {};
%\node (input29) at (4.5,5.80) [feature] {};
%\node (input30) at (4.5,6.00) [feature] {};
%\node (input31) at (4.5,6.20) [feature] {};
%\end{scope}

%\shade[right color=white!10!black,left color=white!50!black] (cfeat0.north east) -- (input3.north west) -- (input0.south west) -- (cfeat0.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat1.north east) -- (input7.north west) -- (input4.south west) -- (cfeat1.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat2.north east) -- (input11.north west) -- (input8.south west) -- (cfeat2.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat3.north east) -- (input15.north west) -- (input12.south west) -- (cfeat3.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat4.north east) -- (input19.north west) -- (input16.south west) -- (cfeat4.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat5.north east) -- (input23.north west) -- (input20.south west) -- (cfeat5.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat6.north east) -- (input27.north west) -- (input24.south west) -- (cfeat6.south east) ;
%\shade[right color=white!10!black,left color=white!50!black] (cfeat7.north east) -- (input31.north west) -- (input28.south west) -- (cfeat7.south east) ;



%\node at (5.0,1.60) [anchor=center,color=white] {\scriptsize{Sensory}};
\node at (6.3,1.60) [anchor=center,color=white] {\scriptsize{Fully-connected}};
\node at (8.3,1.60) [anchor=center,color=white] {\scriptsize{Fully-connected}};
\node at (9.8,1.60) [anchor=center,color=white] {\scriptsize{Motor}};
%\node at (5.0,1.40) [anchor=center,color=white] {\scriptsize{neurons}};
\node at (6.5,1.40) [anchor=center,color=white] {\scriptsize{layer \#1}};
\node at (8.3,1.40) [anchor=center,color=white] {\scriptsize{layer \#2}};
\node at (9.8,1.40) [anchor=center,color=white] {\scriptsize{neurons}};

% Command to motor
\begin{scope}[shift={(5.6,-4.6)}]
\input{layer1.tex}
\end{scope}
\begin{scope}[shift={(8.2,-3.8)}]
\input{layer2.tex}
\end{scope}
\shade[left color=white!10!black,right color=white!50!black] (n19.south east) -- (n1000.south west) -- (n1096.north west)  -- (n999.north east);
\shade[left color=white!10!black,right color=white!50!black] (nout.north west) -- (n1003.north east) -- (n1099.south east)  -- (nout.south west);


\node at (0,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#1}};
\node at (1.5,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#2}};
\node at (2.9,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#3}};
\node at (4.6,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#5}};

\shade[right color=white!10!black,left color=white!50!black] (conv13.north east) -- (conv2.north west) -- (conv2.south west) -- (conv13.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (conv23.north east) -- (conv3.north west) -- (conv3.south west) -- (conv23.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (conv34.north east) -- (conv4.north west) -- (conv4.south west) -- (conv34.south east) ;
\shade[left color=white!10!black,right color=white!50!black] (conv45.north east) -- (n980.north west) -- (n0.south west) -- (conv45.south east) ;

%\draw[exsynsensory]  ($(n7)-(1,0)$) to (n7);
%\draw[white,->] (n7) to (n8);

%\shade[right color=white!10!black,left color=white!50!black] (input0.north east) -- ($(input0.north east)+(0.5,0.03)$) -- ($(input0.south east)+(0.5,-0.03)$)  -- (input0.south east);

\begin{scope}[shift={(9.5,-5.2)}]
\node (cmap) at (0,0) [rotate=90,draw=white!80!black,line width=0.2mm,inner sep=0] {\includegraphics[height=1.4cm]{cmap.png}};
\draw[line width=0.3mm,draw=white] (0.0,0) -- +(0.0,-0.1);
\node at (0,-0.2) [anchor=center,color=white] {\tiny{0}};
\node at (-0.7,-0.2) [anchor=center,color=white] {\tiny{+1}};
\node at (0.7,-0.2) [anchor=center,color=white] {\tiny{-1}};
\node at (0,0.2) [color=white] {\tiny{Normalized neural state}};
\end{scope}

\fill[white,path fading=circle with fuzzy edge 5 percent,opacity=0.9] (2.7,-0.2) circle (0.6cm);
\node at (2.75,-0.2) [] {\gpsmap};
\node at (2.7,0.5) [anchor=center,color=white] {\scriptsize{Map}};


\pgfresetboundingbox
\path[draw] (-2.5,-5.5) rectangle (10.7,2.0);

\end{tikzpicture}
\end{document}
