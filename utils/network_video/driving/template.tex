%\documentclass[border=0cm,convert={outext=.png}]{standalone}
\documentclass[border=0cm]{standalone}
% Documentclass to directly create a PNG-files when invoking 'pdflatex'

\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\renewcommand{\familydefault}{\sfdefault}
\colorlet{ngreen}{green!80!black}
\colorlet{nred}{red!80!black}
\colorlet{ngray}{white!80!black}

\usetikzlibrary{calc}

\usetikzlibrary{fadings}

\makeatletter
\pgfdeclareradialshading{tikz@lib@fade@circle@5}{\pgfpointorigin}{%
	color(0pt)=(pgftransparent!0); color(23.75bp)=(pgftransparent!0);%
	color(25bp)=(pgftransparent!100); color(50bp)=(pgftransparent!100)%
}
\pgfdeclareradialshading{tikz@lib@fade@circle@90}{\pgfpointorigin}{%
	color(0pt)=(pgftransparent!100); color(15bp)=(pgftransparent!100);%
	color(25bp)=(pgftransparent!50); color(50bp)=(pgftransparent!50)%
}
\pgfdeclarefading{circle with fuzzy edge 5 percent}{%
	\pgfuseshading{tikz@lib@fade@circle@15}%
}
\pgfdeclarefading{circle with fuzzy edge 90 percent}{%
	\pgfuseshading{tikz@lib@fade@circle@90}%
}
\makeatother
\begin{tikzfadingfrompicture}[name=custom fade]%
	\path(-0.2cm,0.2cm) rectangle (1.2cm,-2cm); % Arrow line is an overlay!
	\pgfinterruptboundingbox
	\draw[very thick,transparent!20,->] (0cm,0cm) .. controls +(0cm,-1cm) and +(0cm,1cm) .. (1cm,-2cm);
	\endpgfinterruptboundingbox
\end{tikzfadingfrompicture}

\usepackage{pgfplots}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{fadings}
\tikzfading[name=myfading, right color=transparent!50, left color=transparent!0]


\tikzset{
	autogreen/.style={fill=green!80!black},
	autored/.style={fill=red!80!black},
	sensoryline/.style={line width=0.8,draw=white!50!black,opacity=0.5},
	exsynsensory/.style={-{Triangle[length=0.09cm,width=0.09cm]},line width=0.8,draw=white!50!black,opacity=0.5},
	inhsynsensory/.style={-{Bar[width=0.13cm]},shorten >= 0.1cm,line width=0.8,draw=white!50!black,opacity=0.5},
	exsyn/.style={-{Triangle[length=0.09cm,width=0.09cm]},line width=0.8,looseness=1,draw=white!50!black,opacity=0.5},
	inhsyn/.style={-{Bar[width=0.13cm]},shorten >= 0.1cm,line width=0.8,draw=white!50!black,opacity=0.5,looseness=1},
}

% Load dynamic variables
\input{dynamic.tex}

\begin{document}
\begin{tikzpicture}[every node/.style={font={\sffamily}},neuron/.style={circle,inner sep=0.07cm,fill=black!40!white},feature/.style={rectangle,minimum width=0.2cm,minimum height=0.1cm,inner sep=0,fill=black!40!white}]


\draw[fill=black] (-2.5,-5.5) rectangle (10.7,2.0);
%\draw[fill=black] (-2.5,-5.5) rectangle (20.5,1.5);
% My Latex code
%\node at (2.5,-2) [opacity=0.25,white,align=center] {\Huge{Work-in }\\\\\\\Huge{progress}};
%\node at (8.5,-2) [opacity=0.25,white,align=center] {\Huge{Do not}\\\\\\\Huge{distribute}};
\node (cam) at (0,-0.2) [inner sep=0,draw=white,line width=1mm] {\framecamera};

\node at (-2.0,1.7) [anchor=west,color=white] {\footnotesize{NCP driving performance}};
\node at (-2.0,1.4) [anchor=west,color=white] {\scriptsize{\titletext}};
\node at (0,0.8) [anchor=center,color=white] {\scriptsize{Camera input stream}};
\node at (0,-3) [anchor=center,color=white] {\scriptsize{Attention map}};

\draw[automodecolor] (-2,-5.30) circle (0.1cm);
\node at (-1.9,-5.30) [anchor=west,color=white] {\scriptsize{Mode:}};
\node at (-1,-5.30) [anchor=west,color=white] {\scriptsize{\automode}};


\node (conv1) at (0,-1.9) [rectangle,draw=olive,line width=1,inner sep=0] {\layera};
\node (conv12) at ($(conv1)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layera};
\node (conv13) at ($(conv12)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layera};

\shade[top color=white!10!black,bottom color=white!50!black] (cam.south east) -- (conv1.north east) -- (conv1.north west) -- (cam.south west) ;

\node (conv2) at (1.5,-1.9) [rectangle,draw=olive,line width=1,inner sep=0] {\layerc};
\node (conv22) at ($(conv2)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layerc};
\node (conv23) at ($(conv22)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerc};

\node (conv3) at (2.8,-1.8) [rectangle,draw=cyan,line width=1,inner sep=0] {\layerc};
\node (conv32) at ($(conv3)+(0.05,-0.05)$) [rectangle,draw=olive,line width=1,inner sep=0] {\layerc};
\node (conv33) at ($(conv32)+(0.05,-0.05)$) [rectangle,draw=orange,line width=1,inner sep=0] {\layerc};;
\node (conv34) at ($(conv33)+(0.05,-0.05)$) [rectangle,draw=white,line width=1,inner sep=0] {\layerc};

\begin{scope}[shift={(0,-0.1)}]
\node (cfeat7) at (4.2,1) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimga};
\node (cfeat6) at (4.2,0.2) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgb};
\node (cfeat5) at (4.2,-0.6) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgc};
\node (cfeat4) at (4.2,-1.4) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgd};
\node (cfeat3) at (4.2,-2.2) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimge};
\node (cfeat2) at (4.2,-3) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgf};
\node (cfeat1) at (4.2,-3.8) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgg};
\node (cfeat0) at (4.2,-4.6) [inner sep=0,rectangle,draw=white,line width=1,minimum width=0.6cm,minimum height=0.3cm,fill=orange!10!gray] {\featimgh};
\end{scope}


\shade[right color=white!10!black,left color=white!50!black] (conv13.north east) -- (conv2.north west) -- (conv2.south west) -- (conv13.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (conv23.north east) -- (conv3.north west) -- (conv3.south west) -- (conv23.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (conv34.north east) -- (cfeat7.north west) -- (cfeat0.south west) -- (conv34.south east) ;



\node (sal) at (0,-4.0) [,draw=white,line width=1mm,inner sep=0] {\framesaliency};

\begin{scope}[shift={(6.5,0.55)}]
%\node (steer) at (3.5,-2.5) [outputcol,rectangle,draw,minimum width=0.4cm,minimum height=0.4cm] {};
\node (steer) at (3.6,-2.5) [circle,minimum width=0.4cm,minimum height=0.6cm,inner sep=0] {};
\node (n0) at (2.8,-2.5) [neuron,fill=outputcol] {};
\shade[top color=white!10!black,bottom color=white!50!black] (n0.south east) -- (steer.south west) -- (steer.north west) -- (n0.north east) ;

\fill[even odd rule,inner color=outputcol,outer color=black] (3.5,-2.5) circle (0.4);
\draw[thick,color=black] (3.5,-2.5) circle (0.4);
\node (steer) at (3.5,-2.5) [outputrot,circle,inner sep=0] {\includegraphics[width=0.7cm]{wheel.png}};
%\draw[thick,red] (3.5,-1.5) arc (0:50:1cm);

\node (n1) at (2.1,-5) [neuron,fill=neur1] {};
\node (n2) at (1.8,-4) [neuron,fill=neur2] {};
\node (n3) at (1.7,-3) [neuron,fill=neur3] {};
\node (n4) at (1.7,-2) [neuron,fill=neur4] {};
\node (n5) at (1.8,-1) [neuron,fill=neur5] {};
\node (n6) at (2.1,0) [neuron,fill=neur6] {};

\node (n7) at (0.9,-5) [neuron,fill=neur7] {};
\node (n8) at (0.5,-4.5) [neuron,fill=neur8] {};
\node (n9) at (0.2,-4.0) [neuron,fill=neur9] {};
\node (n10) at (0.0,-3.5) [neuron,fill=neur10] {};
\node (n11) at (-0.2,-3) [neuron,fill=neur11] {};
\node (n12) at (-0.3,-2.5) [neuron,fill=neur12] {};
\node (n13) at (-0.3,-2.0) [neuron,fill=neur13] {};
\node (n14) at (-0.2,-1.5) [neuron,fill=neur14] {};
\node (n15) at (0.0,-1.0) [neuron,fill=neur15] {};
\node (n16) at (0.2,-0.5) [neuron,fill=neur16] {};
\node (n17) at (0.5,0) [neuron,fill=neur17] {};
\node (n18) at (0.9,0.5) [neuron,fill=neur18] {};
\end{scope}

\begin{scope}[shift={(1,-5)}]
\node (input0) at (4,0.00) [feature,fill=feat0] {};
\node (input1) at (4,0.20) [feature,fill=feat1] {};
\node (input2) at (4,0.40) [feature,fill=feat2] {};
\node (input3) at (4,0.60) [feature,fill=feat3] {};
\node (input4) at (4,0.80) [feature,fill=feat4] {};
\node (input5) at (4,1.00) [feature,fill=feat5] {};
\node (input6) at (4,1.20) [feature,fill=feat6] {};
\node (input7) at (4,1.40) [feature,fill=feat7] {};
\node (input8) at (4,1.60) [feature,fill=feat8] {};
\node (input9) at (4,1.80) [feature,fill=feat9] {};
\node (input10) at (4,2.00) [feature,fill=feat10] {};
\node (input11) at (4,2.20) [feature,fill=feat11] {};
\node (input12) at (4,2.40) [feature,fill=feat12] {};
\node (input13) at (4,2.60) [feature,fill=feat13] {};
\node (input14) at (4,2.80) [feature,fill=feat14] {};
\node (input15) at (4,3.00) [feature,fill=feat15] {};
\node (input16) at (4,3.20) [feature,fill=feat16] {};
\node (input17) at (4,3.40) [feature,fill=feat17] {};
\node (input18) at (4,3.60) [feature,fill=feat18] {};
\node (input19) at (4,3.80) [feature,fill=feat19] {};
\node (input20) at (4,4.00) [feature,fill=feat20] {};
\node (input21) at (4,4.20) [feature,fill=feat21] {};
\node (input22) at (4,4.40) [feature,fill=feat22] {};
\node (input23) at (4,4.60) [feature,fill=feat23] {};
\node (input24) at (4,4.80) [feature,fill=feat24] {};
\node (input25) at (4,5.00) [feature,fill=feat25] {};
\node (input26) at (4,5.20) [feature,fill=feat26] {};
\node (input27) at (4,5.40) [feature,fill=feat27] {};
\node (input28) at (4,5.60) [feature,fill=feat28] {};
\node (input29) at (4,5.80) [feature,fill=feat29] {};
\node (input30) at (4,6.00) [feature,fill=feat30] {};
\node (input31) at (4,6.20) [feature,fill=feat31] {};
\end{scope}

\shade[right color=white!10!black,left color=white!50!black] (cfeat0.north east) -- (input3.north west) -- (input0.south west) -- (cfeat0.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat1.north east) -- (input7.north west) -- (input4.south west) -- (cfeat1.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat2.north east) -- (input11.north west) -- (input8.south west) -- (cfeat2.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat3.north east) -- (input15.north west) -- (input12.south west) -- (cfeat3.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat4.north east) -- (input19.north west) -- (input16.south west) -- (cfeat4.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat5.north east) -- (input23.north west) -- (input20.south west) -- (cfeat5.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat6.north east) -- (input27.north west) -- (input24.south west) -- (cfeat6.south east) ;
\shade[right color=white!10!black,left color=white!50!black] (cfeat7.north east) -- (input31.north west) -- (input28.south west) -- (cfeat7.south east) ;

% Command to motor
\input{synapses.tex}

\node at (0,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#1}};
\node at (1.5,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#2}};
\node at (3,-2.5) [anchor=center,color=white] {\scriptsize{Conv \#3}};
\node at (4.3,-5.30) [anchor=center,color=white] {\scriptsize{Conv \#5}};
\node at (5.0,1.60) [anchor=center,color=white] {\scriptsize{Sensory}};
\node at (7.0,1.60) [anchor=center,color=white] {\scriptsize{Inter}};
\node at (8.5,1.60) [anchor=center,color=white] {\scriptsize{Command}};
\node at (9.8,1.60) [anchor=center,color=white] {\scriptsize{Motor}};
\node at (5.0,1.40) [anchor=center,color=white] {\scriptsize{neurons}};
\node at (7.0,1.40) [anchor=center,color=white] {\scriptsize{neurons}};
\node at (8.5,1.40) [anchor=center,color=white] {\scriptsize{neurons}};
\node at (9.8,1.40) [anchor=center,color=white] {\scriptsize{neurons}};

%\draw[exsynsensory]  ($(n7)-(1,0)$) to (n7);
%\draw[white,->] (n7) to (n8);

%\shade[right color=white!10!black,left color=white!50!black] (input0.north east) -- ($(input0.north east)+(0.5,0.03)$) -- ($(input0.south east)+(0.5,-0.03)$)  -- (input0.south east);
\begin{scope}[shift={(9.5,-5.2)}]
\node (cmap) at (0,0) [rotate=90,draw=white!80!black,line width=0.2mm,inner sep=0] {\includegraphics[height=1.4cm]{cmap.png}};
\draw[line width=0.3mm,draw=white] (0.0,0) -- +(0.0,-0.1);
\node at (0,-0.2) [anchor=center,color=white] {\tiny{0}};
\node at (-0.7,-0.2) [anchor=center,color=white] {\tiny{+1}};
\node at (0.7,-0.2) [anchor=center,color=white] {\tiny{-1}};
\node at (0,0.2) [color=white] {\tiny{Normalized neural state}};
\end{scope}

\fill[white,path fading=circle with fuzzy edge 5 percent,opacity=0.9] (2.7,-0.2) circle (0.6cm);
\node at (2.75,-0.2) [] {\gpsmap};
\node at (2.7,0.5) [anchor=center,color=white] {\scriptsize{Map}};

\pgfresetboundingbox
\path[draw] (-2.5,-5.5) rectangle (10.7,2.0);

\end{tikzpicture}
\end{document}
